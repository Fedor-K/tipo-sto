<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>TIPO-STO: –¢–µ—Å—Ç –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header { background: #2196F3; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f9f9f9; }
        .btn { display: inline-block; padding: 8px 16px; background: #4CAF50; color: white; text-decoration: none; border-radius: 4px; margin: 2px; }
        .btn:hover { background: #45a049; }
        .btn-1c { background: #FF9800; }
        .btn-1c:hover { background: #F57C00; }
        .status { padding: 10px; border-radius: 4px; margin: 10px 0; }
        .status.ok { background: #E8F5E9; color: #2E7D32; }
        .status.error { background: #FFEBEE; color: #C62828; }
        .status.loading { background: #E3F2FD; color: #1565C0; }
        #config { background: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîß TIPO-STO: –¢–µ—Å—Ç –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞</h1>
        <p>–ü—Ä–æ–≤–µ—Ä–∫–∞: OData + —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–µ–±-–∫–ª–∏–µ–Ω—Ç 1–°</p>
    </div>

    <div id="config" class="card">
        <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
        <div>
            <label>–°–µ—Ä–≤–µ—Ä: <input type="text" id="server" value="rent1c.voshod.local" size="30"></label>
            <label>–ë–∞–∑–∞: <input type="text" id="base" value="autoservice" size="15"></label>
        </div>
        <div>
            <label>–õ–æ–≥–∏–Ω: <input type="text" id="user" value="1c_user_odata" size="15"></label>
            <label>–ü–∞—Ä–æ–ª—å: <input type="password" id="pass" value="5KRvqPVt" size="15"></label>
        </div>
        <div style="margin-top: 10px;">
            <button class="btn" onclick="testOData()">1. –¢–µ—Å—Ç OData</button>
            <button class="btn btn-1c" onclick="open1CWeb()">2. –û—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–∫–ª–∏–µ–Ω—Ç 1–°</button>
        </div>
    </div>

    <div id="odata-status" class="card">
        <h3>üì° –°—Ç–∞—Ç—É—Å OData</h3>
        <div id="odata-result" class="status loading">–ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç OData"</div>
    </div>

    <div id="data-card" class="card" style="display:none;">
        <h3>üë• –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã –∏–∑ Rent1C <span id="count"></span></h3>
        <table>
            <thead>
                <tr>
                    <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                    <th>–ò–ù–ù</th>
                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="data-table"></tbody>
        </table>
    </div>

    <div class="card">
        <h3>üìã –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ 1–° (—Ç–µ—Å—Ç –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞)</h3>
        <p>–≠—Ç–∏ —Å—Å—ã–ª–∫–∏ –æ—Ç–∫—Ä–æ—é—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã –≤ –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–µ 1–°:</p>
        <div id="direct-links">
            <a class="btn btn-1c" href="#" onclick="open1CList('Catalog.–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã')">üìã –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤</a>
            <a class="btn btn-1c" href="#" onclick="open1CList('Catalog.–ê–≤—Ç–æ–º–æ–±–∏–ª–∏')">üöó –°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</a>
            <a class="btn btn-1c" href="#" onclick="open1CList('Document.–ó–∞–∫–∞–∑–ù–∞—Ä—è–¥')">üìÑ –ó–∞–∫–∞–∑-–Ω–∞—Ä—è–¥—ã</a>
            <a class="btn btn-1c" href="#" onclick="open1CList('Catalog.–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞')">üì¶ –ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞</a>
        </div>
    </div>

    <div class="card">
        <h3>‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏</h3>
        <ul>
            <li id="check1">‚¨ú OData –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ</li>
            <li id="check2">‚¨ú –í–µ–±-–∫–ª–∏–µ–Ω—Ç 1–° –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è</li>
            <li id="check3">‚¨ú –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç</li>
            <li id="check4">‚¨ú –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç</li>
        </ul>
    </div>

    <script>
        function getBaseUrl() {
            const server = document.getElementById('server').value;
            const base = document.getElementById('base').value;
            return `http://${server}/${base}`;
        }

        function getAuth() {
            const user = document.getElementById('user').value;
            const pass = document.getElementById('pass').value;
            return 'Basic ' + btoa(user + ':' + pass);
        }

        async function testOData() {
            const resultDiv = document.getElementById('odata-result');
            resultDiv.className = 'status loading';
            resultDiv.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';

            try {
                const url = `${getBaseUrl()}/odata/standard.odata/Catalog_–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã?$top=10&$select=Ref_Key,Description,–ò–ù–ù&$filter=IsFolder eq false`;

                const response = await fetch(url, {
                    headers: { 'Authorization': getAuth() }
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();
                const items = data.value || [];

                resultDiv.className = 'status ok';
                resultDiv.textContent = `‚úÖ OData —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü–æ–ª—É—á–µ–Ω–æ ${items.length} –∑–∞–ø–∏—Å–µ–π`;
                document.getElementById('check1').textContent = '‚úÖ OData –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ';

                // –ü–æ–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
                if (items.length > 0) {
                    document.getElementById('data-card').style.display = 'block';
                    document.getElementById('count').textContent = `(${items.length} —à—Ç.)`;

                    const tbody = document.getElementById('data-table');
                    tbody.innerHTML = items.map(item => `
                        <tr>
                            <td>${item.Description || '‚Äî'}</td>
                            <td>${item.–ò–ù–ù || '‚Äî'}</td>
                            <td>‚Äî</td>
                            <td>
                                <a class="btn" href="#" onclick="open1CItem('Catalog.–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã', '${item.Ref_Key}'); return false;">
                                    –û—Ç–∫—Ä—ã—Ç—å –≤ 1–°
                                </a>
                            </td>
                        </tr>
                    `).join('');
                }

            } catch (error) {
                resultDiv.className = 'status error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;

                if (error.message.includes('Failed to fetch')) {
                    resultDiv.textContent += ' (CORS –∏–ª–∏ —Å–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)';
                }
            }
        }

        function open1CWeb() {
            const url = `${getBaseUrl()}/ru_RU/`;
            window.open(url, '_blank');
            document.getElementById('check2').textContent = '‚úÖ –í–µ–±-–∫–ª–∏–µ–Ω—Ç 1–° –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è';
        }

        function open1CList(entity) {
            const url = `${getBaseUrl()}/ru_RU/#e1cib/list/${entity}`;
            window.open(url, '_blank');
            document.getElementById('check3').textContent = '‚úÖ –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç';
        }

        function open1CItem(entity, refKey) {
            // –§–æ—Ä–º–∞—Ç –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
            const url = `${getBaseUrl()}/ru_RU/#e1cib/data/${entity}?ref=${refKey}`;
            window.open(url, '_blank');
            document.getElementById('check4').textContent = '‚úÖ –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç';
        }
    </script>
</body>
</html>
