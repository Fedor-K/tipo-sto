<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>TIPO-STO: –¢–µ—Å—Ç –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header { background: #2196F3; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f9f9f9; }
        .btn { display: inline-block; padding: 8px 16px; background: #4CAF50; color: white; text-decoration: none; border-radius: 4px; margin: 2px; cursor: pointer; border: none; font-size: 14px; }
        .btn:hover { background: #45a049; }
        .btn-1c { background: #FF9800; }
        .btn-1c:hover { background: #F57C00; }
        .status { padding: 10px; border-radius: 4px; margin: 10px 0; }
        .status.ok { background: #E8F5E9; color: #2E7D32; }
        .status.error { background: #FFEBEE; color: #C62828; }
        .status.loading { background: #E3F2FD; color: #1565C0; }
        .checklist li { padding: 5px 0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>TIPO-STO: –¢–µ—Å—Ç –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞</h1>
        <p>–ü—Ä–æ–≤–µ—Ä–∫–∞: OData —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ + —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–µ–±-–∫–ª–∏–µ–Ω—Ç 1–°</p>
    </div>

    <div class="card">
        <h3>1. –¢–µ—Å—Ç OData (—á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏)</h3>
        <button class="btn" onclick="testOData()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤</button>
        <div id="odata-result" class="status loading">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É</div>
    </div>

    <div id="data-card" class="card" style="display:none;">
        <h3>–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã –∏–∑ Rent1C</h3>
        <table>
            <thead>
                <tr>
                    <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                    <th>–ò–ù–ù</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="data-table"></tbody>
        </table>
    </div>

    <div class="card">
        <h3>2. –¢–µ—Å—Ç –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–∞ 1–°</h3>
        <button class="btn" onclick="testWebClient()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</button>
        <button class="btn btn-1c" onclick="open1CWeb()">–û—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–∫–ª–∏–µ–Ω—Ç</button>
        <div id="webclient-result" class="status loading">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É</div>
    </div>

    <div class="card">
        <h3>3. –ì–ª—É–±–æ–∫–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ 1–°</h3>
        <p>–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –≤ 1–°:</p>
        <button class="btn btn-1c" onclick="open1CList('Catalog.–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã')">–°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤</button>
        <button class="btn btn-1c" onclick="open1CList('Catalog.–ê–≤—Ç–æ–º–æ–±–∏–ª–∏')">–°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</button>
        <button class="btn btn-1c" onclick="open1CList('Document.–ó–∞–∫–∞–∑–ù–∞—Ä—è–¥')">–ó–∞–∫–∞–∑-–Ω–∞—Ä—è–¥—ã</button>
        <div id="deeplink-result" class="status loading">–ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É</div>
    </div>

    <div class="card">
        <h3>–ß–µ–∫-–ª–∏—Å—Ç</h3>
        <ul class="checklist">
            <li id="check1">‚¨ú OData –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ</li>
            <li id="check2">‚¨ú –í–µ–±-–∫–ª–∏–µ–Ω—Ç 1–° –¥–æ—Å—Ç—É–ø–µ–Ω</li>
            <li id="check3">‚¨ú –ì–ª—É–±–æ–∫–∏–µ —Å—Å—ã–ª–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç</li>
            <li id="check4">‚¨ú –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç</li>
        </ul>
        <div id="conclusion" class="status" style="display:none;"></div>
    </div>

    <script>
        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ URL (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –±–µ–∑ –ø–∞—Ä–æ–ª—è)
        const RENT1C_WEB = 'https://–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:@aclient.1c-hosting.com/1R96614/1R96614_AA61AS_e771ys34or/ru_RU/';
        let checks = { odata: false, webclient: false, deeplink: false, item: false };

        async function testOData() {
            const resultDiv = document.getElementById('odata-result');
            resultDiv.className = 'status loading';
            resultDiv.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';

            try {
                const url = '/proxy/odata/Catalog_–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã?$top=10&$select=Ref_Key,Description,–ò–ù–ù&$filter=IsFolder eq false';
                const response = await fetch(url);
                const data = await response.json();

                if (data.error) throw new Error(data.error);

                const items = data.value || [];
                resultDiv.className = 'status ok';
                resultDiv.textContent = `‚úÖ –ü–æ–ª—É—á–µ–Ω–æ ${items.length} –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤`;
                document.getElementById('check1').textContent = '‚úÖ OData –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ';
                checks.odata = true;

                if (items.length > 0) {
                    document.getElementById('data-card').style.display = 'block';
                    const tbody = document.getElementById('data-table');
                    tbody.innerHTML = items.map(item => `
                        <tr>
                            <td>${item.Description || '‚Äî'}</td>
                            <td>${item.–ò–ù–ù || '‚Äî'}</td>
                            <td>
                                <button class="btn btn-1c" onclick="open1CItem('Catalog.–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã', '${item.Ref_Key}')">
                                    –û—Ç–∫—Ä—ã—Ç—å –≤ 1–°
                                </button>
                            </td>
                        </tr>
                    `).join('');
                }
                checkConclusion();

            } catch (error) {
                resultDiv.className = 'status error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        async function testWebClient() {
            const resultDiv = document.getElementById('webclient-result');
            resultDiv.className = 'status loading';
            resultDiv.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';

            try {
                const response = await fetch('/proxy/webclient');
                const data = await response.json();

                if (data.error) throw new Error(data.error);

                resultDiv.className = 'status ok';
                resultDiv.textContent = `‚úÖ –í–µ–±-–∫–ª–∏–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–µ–Ω (HTTP ${data.code})`;
                document.getElementById('check2').textContent = '‚úÖ –í–µ–±-–∫–ª–∏–µ–Ω—Ç 1–° –¥–æ—Å—Ç—É–ø–µ–Ω';
                checks.webclient = true;
                checkConclusion();

            } catch (error) {
                resultDiv.className = 'status error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            }
        }

        function open1CWeb() {
            window.open(RENT1C_WEB, '_blank');
        }

        function open1CList(entity) {
            const url = RENT1C_WEB + '#e1cib/list/' + entity;
            window.open(url, '_blank');
            document.getElementById('deeplink-result').className = 'status ok';
            document.getElementById('deeplink-result').textContent = `‚úÖ –û—Ç–∫—Ä—ã—Ç–∞ —Å—Å—ã–ª–∫–∞: ${entity}`;
            document.getElementById('check3').textContent = '‚úÖ –ì–ª—É–±–æ–∫–∏–µ —Å—Å—ã–ª–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç';
            checks.deeplink = true;
            checkConclusion();
        }

        function open1CItem(entity, refKey) {
            const url = RENT1C_WEB + '#e1cib/data/' + entity + '?ref=' + refKey;
            window.open(url, '_blank');
            document.getElementById('check4').textContent = '‚úÖ –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç';
            checks.item = true;
            checkConclusion();
        }

        function checkConclusion() {
            const allPassed = checks.odata && checks.webclient && checks.deeplink && checks.item;
            const conclusionDiv = document.getElementById('conclusion');

            if (allPassed) {
                conclusionDiv.style.display = 'block';
                conclusionDiv.className = 'status ok';
                conclusionDiv.innerHTML = '<strong>üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!</strong><br>–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ú–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å TIPO-STO –Ω–∞ Rent1C.';
            }
        }
    </script>
</body>
</html>
